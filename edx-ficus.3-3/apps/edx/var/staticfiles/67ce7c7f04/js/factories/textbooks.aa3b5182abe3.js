/*
* Underscore.string
* (c) 2010 Esa-Matti Suuronen <esa-matti aet suuronen dot org>
* Underscore.string is freely distributable under the terms of the MIT license.
* Documentation: https://github.com/epeli/underscore.string
* Some code is borrowed from MooTools and Alexandru Marasteanu.
* Version '3.3.4'
* @preserve
*/

/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

/*!
 * jQuery Form Plugin
 * version: 3.18 (28-SEP-2012)
 * @requires jQuery v1.5 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("underscore.string",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.s=e()}}(function(){var e;return function t(e,n,i){function r(o,s){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};e[o][0].call(u.exports,function(t){var n=e[o][1][t];return r(n?n:t)},u,u.exports,t,e,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){var i=e("./trim"),r=e("./decapitalize");t.exports=function(e,t){return e=i(e).replace(/[-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""}),t===!0?r(e):e}},{"./decapitalize":10,"./trim":65}],2:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e);var n=t?e.slice(1).toLowerCase():e.slice(1);return e.charAt(0).toUpperCase()+n}},{"./helper/makeString":20}],3:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return i(e).split("")}},{"./helper/makeString":20}],4:[function(e,t,n){t.exports=function(e,t){return null==e?[]:(e=String(e),t=~~t,t>0?e.match(new RegExp(".{1,"+t+"}","g")):[e])}},{}],5:[function(e,t,n){var i=e("./capitalize"),r=e("./camelize"),a=e("./helper/makeString");t.exports=function(e){return e=a(e),i(r(e.replace(/[\W_]/g," ")).replace(/\s/g,""))}},{"./camelize":1,"./capitalize":2,"./helper/makeString":20}],6:[function(e,t,n){var i=e("./trim");t.exports=function(e){return i(e).replace(/\s\s+/g," ")}},{"./trim":65}],7:[function(e,t,n){var i=e("./helper/makeString"),r="ąàáäâãåæăćčĉęèéëêĝĥìíïîĵłľńňòóöőôõðøśșşšŝťțţŭùúüűûñÿýçżźž",a="aaaaaaaaaccceeeeeghiiiijllnnoooooooossssstttuuuuuunyyczzz";r+=r.toUpperCase(),a+=a.toUpperCase(),a=a.split(""),r+="ß",a.push("ss"),t.exports=function(e){return i(e).replace(/.{1}/g,function(e){var t=r.indexOf(e);return-1===t?e:a[t]})}},{"./helper/makeString":20}],8:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){return e=i(e),t=i(t),0===e.length||0===t.length?0:e.split(t).length-1}},{"./helper/makeString":20}],9:[function(e,t,n){var i=e("./trim");t.exports=function(e){return i(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}},{"./trim":65}],10:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return e=i(e),e.charAt(0).toLowerCase()+e.slice(1)}},{"./helper/makeString":20}],11:[function(e,t,n){function i(e){for(var t=e.match(/^[\s\\t]*/gm),n=t[0].length,i=1;i<t.length;i++)n=Math.min(t[i].length,n);return n}var r=e("./helper/makeString");t.exports=function(e,t){e=r(e);var n,a=i(e);return 0===a?e:(n="string"==typeof t?new RegExp("^"+t,"gm"):new RegExp("^[ \\t]{"+a+"}","gm"),e.replace(n,""))}},{"./helper/makeString":20}],12:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/toPositive");t.exports=function(e,t,n){return e=i(e),t=""+t,n="undefined"==typeof n?e.length-t.length:Math.min(r(n),e.length)-t.length,n>=0&&e.indexOf(t,n)===n}},{"./helper/makeString":20,"./helper/toPositive":22}],13:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/escapeChars"),a="[";for(var o in r)a+=o;a+="]";var s=new RegExp(a,"g");t.exports=function(e){return i(e).replace(s,function(e){return"&"+r[e]+";"})}},{"./helper/escapeChars":17,"./helper/makeString":20}],14:[function(e,t,n){t.exports=function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!t.match(/^(?:include|contains|reverse|join|map|wrap)$/)&&(e[t]=this[t]);return e}},{}],15:[function(e,t,n){var i=e("./makeString");t.exports=function(e,t){return e=i(e),0===e.length?"":e.slice(0,-1)+String.fromCharCode(e.charCodeAt(e.length-1)+t)}},{"./makeString":20}],16:[function(e,t,n){var i=e("./escapeRegExp");t.exports=function(e){return null==e?"\\s":e.source?e.source:"["+i(e)+"]"}},{"./escapeRegExp":18}],17:[function(e,t,n){var i={"¢":"cent","£":"pound","¥":"yen","€":"euro","©":"copy","®":"reg","<":"lt",">":"gt",'"':"quot","&":"amp","'":"#39"};t.exports=i},{}],18:[function(e,t,n){var i=e("./makeString");t.exports=function(e){return i(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}},{"./makeString":20}],19:[function(e,t,n){var i={nbsp:" ",cent:"¢",pound:"£",yen:"¥",euro:"€",copy:"©",reg:"®",lt:"<",gt:">",quot:'"',amp:"&",apos:"'"};t.exports=i},{}],20:[function(e,t,n){t.exports=function(e){return null==e?"":""+e}},{}],21:[function(e,t,n){t.exports=function(e,t){if(1>t)return"";for(var n="";t>0;)1&t&&(n+=e),t>>=1,e+=e;return n}},{}],22:[function(e,t,n){t.exports=function(e){return 0>e?0:+e||0}},{}],23:[function(e,t,n){var i=e("./capitalize"),r=e("./underscored"),a=e("./trim");t.exports=function(e){return i(a(r(e).replace(/_id$/,"").replace(/_/g," ")))}},{"./capitalize":2,"./trim":65,"./underscored":67}],24:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){return""===t?!0:-1!==i(e).indexOf(t)}},{"./helper/makeString":20}],25:[function(e,t,n){function i(e){return this instanceof i?void(this._wrapped=e):new i(e)}function r(e,t){"function"==typeof t&&(i.prototype[e]=function(){var e=[this._wrapped].concat(Array.prototype.slice.call(arguments)),n=t.apply(null,e);return"string"==typeof n?new i(n):n})}function a(e){r(e,function(t){var n=Array.prototype.slice.call(arguments,1);return String.prototype[e].apply(t,n)})}i.VERSION="3.3.4",i.isBlank=e("./isBlank"),i.stripTags=e("./stripTags"),i.capitalize=e("./capitalize"),i.decapitalize=e("./decapitalize"),i.chop=e("./chop"),i.trim=e("./trim"),i.clean=e("./clean"),i.cleanDiacritics=e("./cleanDiacritics"),i.count=e("./count"),i.chars=e("./chars"),i.swapCase=e("./swapCase"),i.escapeHTML=e("./escapeHTML"),i.unescapeHTML=e("./unescapeHTML"),i.splice=e("./splice"),i.insert=e("./insert"),i.replaceAll=e("./replaceAll"),i.include=e("./include"),i.join=e("./join"),i.lines=e("./lines"),i.dedent=e("./dedent"),i.reverse=e("./reverse"),i.startsWith=e("./startsWith"),i.endsWith=e("./endsWith"),i.pred=e("./pred"),i.succ=e("./succ"),i.titleize=e("./titleize"),i.camelize=e("./camelize"),i.underscored=e("./underscored"),i.dasherize=e("./dasherize"),i.classify=e("./classify"),i.humanize=e("./humanize"),i.ltrim=e("./ltrim"),i.rtrim=e("./rtrim"),i.truncate=e("./truncate"),i.prune=e("./prune"),i.words=e("./words"),i.pad=e("./pad"),i.lpad=e("./lpad"),i.rpad=e("./rpad"),i.lrpad=e("./lrpad"),i.sprintf=e("./sprintf"),i.vsprintf=e("./vsprintf"),i.toNumber=e("./toNumber"),i.numberFormat=e("./numberFormat"),i.strRight=e("./strRight"),i.strRightBack=e("./strRightBack"),i.strLeft=e("./strLeft"),i.strLeftBack=e("./strLeftBack"),i.toSentence=e("./toSentence"),i.toSentenceSerial=e("./toSentenceSerial"),i.slugify=e("./slugify"),i.surround=e("./surround"),i.quote=e("./quote"),i.unquote=e("./unquote"),i.repeat=e("./repeat"),i.naturalCmp=e("./naturalCmp"),i.levenshtein=e("./levenshtein"),i.toBoolean=e("./toBoolean"),i.exports=e("./exports"),i.escapeRegExp=e("./helper/escapeRegExp"),i.wrap=e("./wrap"),i.map=e("./map"),i.strip=i.trim,i.lstrip=i.ltrim,i.rstrip=i.rtrim,i.center=i.lrpad,i.rjust=i.lpad,i.ljust=i.rpad,i.contains=i.include,i.q=i.quote,i.toBool=i.toBoolean,i.camelcase=i.camelize,i.mapChars=i.map,i.prototype={value:function(){return this._wrapped}};for(var o in i)r(o,i[o]);r("tap",function(e,t){return t(e)});var s=["toUpperCase","toLowerCase","split","replace","slice","substring","substr","concat"];for(var l in s)a(s[l]);t.exports=i},{"./camelize":1,"./capitalize":2,"./chars":3,"./chop":4,"./classify":5,"./clean":6,"./cleanDiacritics":7,"./count":8,"./dasherize":9,"./decapitalize":10,"./dedent":11,"./endsWith":12,"./escapeHTML":13,"./exports":14,"./helper/escapeRegExp":18,"./humanize":23,"./include":24,"./insert":26,"./isBlank":27,"./join":28,"./levenshtein":29,"./lines":30,"./lpad":31,"./lrpad":32,"./ltrim":33,"./map":34,"./naturalCmp":35,"./numberFormat":38,"./pad":39,"./pred":40,"./prune":41,"./quote":42,"./repeat":43,"./replaceAll":44,"./reverse":45,"./rpad":46,"./rtrim":47,"./slugify":48,"./splice":49,"./sprintf":50,"./startsWith":51,"./strLeft":52,"./strLeftBack":53,"./strRight":54,"./strRightBack":55,"./stripTags":56,"./succ":57,"./surround":58,"./swapCase":59,"./titleize":60,"./toBoolean":61,"./toNumber":62,"./toSentence":63,"./toSentenceSerial":64,"./trim":65,"./truncate":66,"./underscored":67,"./unescapeHTML":68,"./unquote":69,"./vsprintf":70,"./words":71,"./wrap":72}],26:[function(e,t,n){var i=e("./splice");t.exports=function(e,t,n){return i(e,t,0,n)}},{"./splice":49}],27:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return/^\s*$/.test(i(e))}},{"./helper/makeString":20}],28:[function(e,t,n){var i=e("./helper/makeString"),r=[].slice;t.exports=function(){var e=r.call(arguments),t=e.shift();return e.join(i(t))}},{"./helper/makeString":20}],29:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){"use strict";if(e=i(e),t=i(t),e===t)return 0;if(!e||!t)return Math.max(e.length,t.length);for(var n=new Array(t.length+1),r=0;r<n.length;++r)n[r]=r;for(r=0;r<e.length;++r){for(var a=r+1,o=0;o<t.length;++o){var s=a;a=n[o]+(e.charAt(r)===t.charAt(o)?0:1);var l=s+1;a>l&&(a=l),l=n[o+1]+1,a>l&&(a=l),n[o]=s}n[o]=a}return a}},{"./helper/makeString":20}],30:[function(e,t,n){t.exports=function(e){return null==e?[]:String(e).split(/\r\n?|\n/)}},{}],31:[function(e,t,n){var i=e("./pad");t.exports=function(e,t,n){return i(e,t,n)}},{"./pad":39}],32:[function(e,t,n){var i=e("./pad");t.exports=function(e,t,n){return i(e,t,n,"both")}},{"./pad":39}],33:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/defaultToWhiteSpace"),a=String.prototype.trimLeft;t.exports=function(e,t){return e=i(e),!t&&a?a.call(e):(t=r(t),e.replace(new RegExp("^"+t+"+"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":20}],34:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){return e=i(e),0===e.length||"function"!=typeof t?e:e.replace(/./g,t)}},{"./helper/makeString":20}],35:[function(e,t,n){t.exports=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var n=/(\.\d+|\d+|\D+)/g,i=String(e).match(n),r=String(t).match(n),a=Math.min(i.length,r.length),o=0;a>o;o++){var s=i[o],l=r[o];if(s!==l){var c=+s,u=+l;return c===c&&u===u?c>u?1:-1:l>s?-1:1}}return i.length!=r.length?i.length-r.length:t>e?-1:1}},{}],36:[function(t,n,i){!function(t){function n(){var e=arguments[0],t=n.cache;return t[e]&&t.hasOwnProperty(e)||(t[e]=n.parse(e)),n.format.call(null,t[e],arguments)}function r(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function a(e,t){return Array(t+1).join(e)}var o={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};n.format=function(e,t){var i,s,l,c,u,p,d,f=1,h=e.length,m="",g=[],v=!0,x="";for(s=0;h>s;s++)if(m=r(e[s]),"string"===m)g[g.length]=e[s];else if("array"===m){if(c=e[s],c[2])for(i=t[f],l=0;l<c[2].length;l++){if(!i.hasOwnProperty(c[2][l]))throw new Error(n("[sprintf] property '%s' does not exist",c[2][l]));i=i[c[2][l]]}else i=c[1]?t[c[1]]:t[f++];if("function"==r(i)&&(i=i()),o.not_string.test(c[8])&&o.not_json.test(c[8])&&"number"!=r(i)&&isNaN(i))throw new TypeError(n("[sprintf] expecting number but found %s",r(i)));switch(o.number.test(c[8])&&(v=i>=0),c[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":case"i":i=parseInt(i,10);break;case"j":i=JSON.stringify(i,null,c[6]?parseInt(c[6]):0);break;case"e":i=c[7]?i.toExponential(c[7]):i.toExponential();break;case"f":i=c[7]?parseFloat(i).toFixed(c[7]):parseFloat(i);break;case"g":i=c[7]?parseFloat(i).toPrecision(c[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&c[7]?i.substring(0,c[7]):i;break;case"u":i>>>=0;break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}o.json.test(c[8])?g[g.length]=i:(!o.number.test(c[8])||v&&!c[3]?x="":(x=v?"+":"-",i=i.toString().replace(o.sign,"")),p=c[4]?"0"===c[4]?"0":c[4].charAt(1):" ",d=c[6]-(x+i).length,u=c[6]&&d>0?a(p,d):"",g[g.length]=c[5]?x+i+u:"0"===p?x+u+i:u+x+i)}return g.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=o.text.exec(t)))i[i.length]=n[0];else if(null!==(n=o.modulo.exec(t)))i[i.length]="%";else{if(null===(n=o.placeholder.exec(t)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){r|=1;var a=[],s=n[2],l=[];if(null===(l=o.key.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a[a.length]=l[1];""!==(s=s.substring(l[0].length));)if(null!==(l=o.key_access.exec(s)))a[a.length]=l[1];else{if(null===(l=o.index_access.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");a[a.length]=l[1]}n[2]=a}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i[i.length]=n}t=t.substring(n[0].length)}return i};var s=function(e,t,i){return i=(t||[]).slice(0),i.splice(0,0,e),n.apply(null,i)};"undefined"!=typeof i?(i.sprintf=n,i.vsprintf=s):(t.sprintf=n,t.vsprintf=s,"function"==typeof e&&e.amd&&e(function(){return{sprintf:n,vsprintf:s}}))}("undefined"==typeof window?this:window)},{}],37:[function(e,t,n){(function(e){function n(e,t){function n(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}if(i("noDeprecation"))return e;var r=!1;return n}function i(t){try{if(!e.localStorage)return!1}catch(n){return!1}var i=e.localStorage[t];return null==i?!1:"true"===String(i).toLowerCase()}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(e,t,n){t.exports=function(e,t,n,i){if(isNaN(e)||null==e)return"";e=e.toFixed(~~t),i="string"==typeof i?i:",";var r=e.split("."),a=r[0],o=r[1]?(n||".")+r[1]:"";return a.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+i)+o}},{}],39:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/strRepeat");t.exports=function(e,t,n,a){e=i(e),t=~~t;var o=0;switch(n?n.length>1&&(n=n.charAt(0)):n=" ",a){case"right":return o=t-e.length,e+r(n,o);case"both":return o=t-e.length,r(n,Math.ceil(o/2))+e+r(n,Math.floor(o/2));default:return o=t-e.length,r(n,o)+e}}},{"./helper/makeString":20,"./helper/strRepeat":21}],40:[function(e,t,n){var i=e("./helper/adjacent");t.exports=function(e){return i(e,-1)}},{"./helper/adjacent":15}],41:[function(e,t,n){var i=e("./helper/makeString"),r=e("./rtrim");t.exports=function(e,t,n){if(e=i(e),t=~~t,n=null!=n?String(n):"...",e.length<=t)return e;var a=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},o=e.slice(0,t+1).replace(/.(?=\W*\w*$)/g,a);return o=o.slice(o.length-2).match(/\w\w/)?o.replace(/\s*\S+$/,""):r(o.slice(0,o.length-1)),(o+n).length>e.length?e:e.slice(0,o.length)+n}},{"./helper/makeString":20,"./rtrim":47}],42:[function(e,t,n){var i=e("./surround");t.exports=function(e,t){return i(e,t||'"')}},{"./surround":58}],43:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/strRepeat");t.exports=function a(e,t,n){if(e=i(e),t=~~t,null==n)return r(e,t);for(var a=[];t>0;a[--t]=e);return a.join(n)}},{"./helper/makeString":20,"./helper/strRepeat":21}],44:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t,n,r){var a=r===!0?"gi":"g",o=new RegExp(t,a);return i(e).replace(o,n)}},{"./helper/makeString":20}],45:[function(e,t,n){var i=e("./chars");t.exports=function(e){return i(e).reverse().join("")}},{"./chars":3}],46:[function(e,t,n){var i=e("./pad");t.exports=function(e,t,n){return i(e,t,n,"right")}},{"./pad":39}],47:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/defaultToWhiteSpace"),a=String.prototype.trimRight;t.exports=function(e,t){return e=i(e),!t&&a?a.call(e):(t=r(t),e.replace(new RegExp(t+"+$"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":20}],48:[function(e,t,n){var i=e("./trim"),r=e("./dasherize"),a=e("./cleanDiacritics");t.exports=function(e){return i(r(a(e).replace(/[^\w\s-]/g,"-").toLowerCase()),"-")}},{"./cleanDiacritics":7,"./dasherize":9,"./trim":65}],49:[function(e,t,n){var i=e("./chars");t.exports=function(e,t,n,r){var a=i(e);return a.splice(~~t,~~n,r),a.join("")}},{"./chars":3}],50:[function(e,t,n){var i=e("util-deprecate");t.exports=i(e("sprintf-js").sprintf,"sprintf() will be removed in the next major release, use the sprintf-js package instead.")},{"sprintf-js":36,"util-deprecate":37}],51:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/toPositive");t.exports=function(e,t,n){return e=i(e),t=""+t,n=null==n?0:Math.min(r(n),e.length),e.lastIndexOf(t,n)===n}},{"./helper/makeString":20,"./helper/toPositive":22}],52:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e),t=i(t);var n=t?e.indexOf(t):-1;return~n?e.slice(0,n):e}},{"./helper/makeString":20}],53:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e),t=i(t);var n=e.lastIndexOf(t);return~n?e.slice(0,n):e}},{"./helper/makeString":20}],54:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e),t=i(t);var n=t?e.indexOf(t):-1;return~n?e.slice(n+t.length,e.length):e}},{"./helper/makeString":20}],55:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e),t=i(t);var n=t?e.lastIndexOf(t):-1;return~n?e.slice(n+t.length,e.length):e}},{"./helper/makeString":20}],56:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return i(e).replace(/<\/?[^>]+>/g,"")}},{"./helper/makeString":20}],57:[function(e,t,n){var i=e("./helper/adjacent");t.exports=function(e){return i(e,1)}},{"./helper/adjacent":15}],58:[function(e,t,n){t.exports=function(e,t){return[t,e,t].join("")}},{}],59:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return i(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})}},{"./helper/makeString":20}],60:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e){return i(e).toLowerCase().replace(/(?:^|\s|-)\S/g,function(e){return e.toUpperCase()})}},{"./helper/makeString":20}],61:[function(e,t,n){function i(e,t){var n,i,r=e.toLowerCase();for(t=[].concat(t),n=0;n<t.length;n+=1)if(i=t[n]){if(i.test&&i.test(e))return!0;if(i.toLowerCase()===r)return!0}}var r=e("./trim");t.exports=function(e,t,n){return"number"==typeof e&&(e=""+e),"string"!=typeof e?!!e:(e=r(e),i(e,t||["true","1"])?!0:i(e,n||["false","0"])?!1:void 0)}},{"./trim":65}],62:[function(e,t,n){t.exports=function(e,t){if(null==e)return 0;var n=Math.pow(10,isFinite(t)?t:0);return Math.round(e*n)/n}},{}],63:[function(e,t,n){var i=e("./rtrim");t.exports=function(e,t,n,r){t=t||", ",n=n||" and ";var a=e.slice(),o=a.pop();return e.length>2&&r&&(n=i(t)+n),a.length?a.join(t)+n+o:o}},{"./rtrim":47}],64:[function(e,t,n){var i=e("./toSentence");t.exports=function(e,t,n){return i(e,t,n,!0)}},{"./toSentence":63}],65:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/defaultToWhiteSpace"),a=String.prototype.trim;t.exports=function(e,t){return e=i(e),!t&&a?a.call(e):(t=r(t),e.replace(new RegExp("^"+t+"+|"+t+"+$","g"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":20}],66:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t,n){return e=i(e),n=n||"...",t=~~t,e.length>t?e.slice(0,t)+n:e}},{"./helper/makeString":20}],67:[function(e,t,n){var i=e("./trim");t.exports=function(e){return i(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()}},{"./trim":65}],68:[function(e,t,n){var i=e("./helper/makeString"),r=e("./helper/htmlEntities");t.exports=function(e){return i(e).replace(/\&([^;]+);/g,function(e,t){var n;return t in r?r[t]:(n=t.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(n[1],16)):(n=t.match(/^#(\d+)$/))?String.fromCharCode(~~n[1]):e})}},{"./helper/htmlEntities":19,"./helper/makeString":20}],69:[function(e,t,n){t.exports=function(e,t){return t=t||'"',e[0]===t&&e[e.length-1]===t?e.slice(1,e.length-1):e}},{}],70:[function(e,t,n){var i=e("util-deprecate");t.exports=i(e("sprintf-js").vsprintf,"vsprintf() will be removed in the next major release, use the sprintf-js package instead.")},{"sprintf-js":36,"util-deprecate":37}],71:[function(e,t,n){var i=e("./isBlank"),r=e("./trim");t.exports=function(e,t){return i(e)?[]:r(e,t).split(t||/\s+/)}},{"./isBlank":27,"./trim":65}],72:[function(e,t,n){var i=e("./helper/makeString");t.exports=function(e,t){e=i(e),t=t||{};var n,r=t.width||75,a=t.seperator||"\n",o=t.cut||!1,s=t.preserveSpaces||!1,l=t.trailingSpaces||!1;if(0>=r)return e;if(o){var c=0;for(n="";c<e.length;)c%r==0&&c>0&&(n+=a),n+=e.charAt(c),c++;if(l)for(;c%r>0;)n+=" ",c++;return n}var u=e.split(" "),p=0;for(n="";u.length>0;){if(1+u[0].length+p>r&&p>0){if(s)n+=" ",p++;else if(l)for(;r>p;)n+=" ",p++;n+=a,p=0}p>0&&(n+=" ",p++),n+=u[0],p+=u[0].length,u.shift()}if(l)for(;r>p;)n+=" ",p++;return n}},{"./helper/makeString":20}]},{},[25])(25)}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!common/templates/components/system-feedback.underscore",[],function(){return'<div class="wrapper wrapper-<%= type %> wrapper-<%= type %>-<%= intent %>\n            <% if(obj.shown) { %>is-shown<% } else { %>is-hiding<% } %>\n            <% if(_.contains([\'help\', \'mini\'], intent)) { %>wrapper-<%= type %>-status<% } %>"\n     id="<%= type %>-<%= intent %>"\n     aria-hidden="<% if(obj.shown) { %>false<% } else { %>true<% } %>"\n     aria-labelledby="<%= type %>-<%= intent %>-title"\n     tabindex="-1"\n     <% if (obj.message) { %>aria-describedby="<%= type %>-<%= intent %>-description" <% } %>\n     <% if (obj.actions) { %>role="dialog"<% } %>\n  >\n  <div class="<%= type %> <%= intent %> <% if(obj.actions) { %>has-actions<% } %>">\n    <% if(obj.icon) { %>\n      <% var iconClass = {"warning": "warning", "confirmation": "check", "error": "warning", "announcement": "bullhorn", "step-required": "exclamation-circle", "help": "question", "mini": "cog"} %>\n      <span class="feedback-symbol fa fa-<%= iconClass[intent] %>" aria-hidden="true"></span>\n    <% } %>\n\n    <div class="copy">\n      <h2 class="title title-3" id="<%= type %>-<%= intent %>-title"><%- title %></h2>\n      <% if(obj.message) { %><p class="message" id="<%= type %>-<%= intent %>-description"><%- message %></p><% } %>\n    </div>\n\n    <% if(obj.actions) { %>\n    <nav class="nav-actions">\n      <ul>\n        <% if(actions.primary) { %>\n        <li class="nav-item">\n          <button class="action-primary <%= actions.primary.class %>"><%- actions.primary.text %></button>\n        </li>\n        <% } %>\n        <% if(actions.secondary) {\n             _.each(actions.secondary, function(secondary) { %>\n        <li class="nav-item">\n          <button class="action-secondary <%= secondary.class %>"><%- secondary.text %></button>\n        </li>\n        <%   });\n           } %>\n      </ul>\n    </nav>\n    <% } %>\n\n    <% if(obj.closeIcon) { %>\n    <a href="#" rel="view" class="action action-close action-<%= type %>-close">\n      <span class="icon fa fa-times-circle" aria-hidden="true"></span>\n      <span class="label">close <%= type %></span>\n    </a>\n    <% } %>\n  </div>\n</div>\n'}),function(e){"use strict";e("common/js/components/views/feedback",["jquery","underscore","underscore.string","backbone","text!common/templates/components/system-feedback.underscore"],function(e,t,n,i,r){var a=["a[href]:not([tabindex='-1'])","area[href]:not([tabindex='-1'])","input:not([disabled]):not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","iframe:not([tabindex='-1'])","[tabindex]:not([tabindex='-1'])","[contentEditable=true]:not([tabindex='-1'])"],o=i.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0,outFocusElement:null},initialize:function(n){if(this.options=t.extend({},this.options,n),!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},inFocus:function(){this.options.outFocusElement=this.options.outFocusElement||document.activeElement,this.$(".wrapper").first().focus();var e=this.$(a.join());return e.on("keydown",function(t){9===t.which&&t.shiftKey&&t.target===e.first()[0]?(t.preventDefault(),e.last().focus()):9!==t.which||t.shiftKey||t.target!==e.last()[0]||(t.preventDefault(),e.first().focus())}),this},outFocus:function(){this.$(a.join()).off("keydown");return this.options.outFocusElement&&this.options.outFocusElement.focus(),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=o["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),this.$el.html(t.template(r)(this.options)),o["active_"+this.options.type]=this,this},primaryClick:function(e){var t,n;t=this.options.actions,t&&(n=t.primary,n&&(n.preventDefault!==!1&&e.preventDefault(),n.click&&n.click.call(e.target,this,e)))},secondaryClick:function(e){var n,i,r,a;n=this.options.actions,n&&(i=n.secondary,i&&(a=0,e&&e.target&&(a=t.indexOf(this.$(".action-secondary"),e.target)),r=i[a],r.preventDefault!==!1&&e.preventDefault(),r.click&&r.click.call(e.target,this,e)))}});return o})}.call(this,define||RequireJS.define),function(e){"use strict";e("common/js/components/views/feedback_notification",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(e,t,n,i){var r,a,o=i.extend({options:e.extend({},i.prototype.options,{type:"notification",closeIcon:!1})});r=t.compose(n.capitalize,n.camelize),a=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(a,function(t){var n;n=o.extend({options:e.extend({},o.prototype.options,{intent:t})}),o[r(t)]=n});var s=o.Mini.prototype.options;return s.minShown=1250,s.closeIcon=!1,o})}.call(this,define||RequireJS.define),define("js/utils/module",["underscore"],function(e){var t="/xblock",n=function(n){return e.isUndefined(n)?t+"/":t+"/"+n};return{urlRoot:t,getUpdateUrl:n}}),define("js/models/section",["backbone","gettext","common/js/components/views/feedback_notification","js/utils/module"],function(e,t,n,i){var r=e.Model.extend({defaults:{name:""},validate:function(e,n){return e.name?void 0:t("You must specify a name")},urlRoot:i.urlRoot,toJSON:function(){return{metadata:{display_name:this.get("name")}}},initialize:function(){this.listenTo(this,"request",this.showNotification),this.listenTo(this,"sync",this.hideNotification)},showNotification:function(){this.msg||(this.msg=new n.Mini({title:t("Saving")})),this.msg.show()},hideNotification:function(){this.msg&&this.msg.hide()}});return r}),function(){var e,t,n,i,r,a,o,s,l,c,u=this;"undefined"==typeof window?(e=require("underscore"),t=require("backbone"),"undefined"!=typeof exports&&(exports=module.exports=t)):(e=u._,t=u.Backbone),n=t.Model,i=t.Collection,r=n.prototype,a=i.prototype,l=/[\.\[\]]+/g,o="change add remove reset sort destroy".split(" "),c=["reset","sort"],t.Associations={VERSION:"0.5.0"},t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",s=t.AssociatedModel=t.Associations.AssociatedModel=n.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=r.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(t,n,i){var r;return e.isObject(t)||null==t?(r=t,i=n):(r={},r[t]=n),t=this._set(r,i),this._processPendingEvents(),t},_set:function(t,n){var i,r,a,o,c=this;if(!t)return this;for(i in t)if(r||(r={}),i.match(l)){var u=d(i);o=e.initial(u),u=u[u.length-1],o=this.get(o),o instanceof s&&(o=r[o.cid]||(r[o.cid]={model:o,data:{}}),o.data[u]=t[i])}else o=r[this.cid]||(r[this.cid]={model:this,data:{}}),o.data[i]=t[i];if(r)for(a in r)o=r[a],this._setAttr.call(o.model,o.data,n)||(c=!1);else c=this._setAttr.call(this,t,n);return c},_setAttr:function(n,a){var o;if(a||(a={}),a.unset)for(o in n)n[o]=void 0;return this.parents=this.parents||[],this.relations&&e.each(this.relations,function(r){var o,l,c,u,p=r.key,d=r.relatedModel,h=r.collectionType,m=r.map,g=this.attributes[p],v=g&&g.idAttribute;if(d&&e.isString(d)&&(d=f(d)),h&&e.isString(h)&&(h=f(h)),m&&e.isString(m)&&(m=f(m)),l=r.options?e.extend({},r.options,a):a,n[p]){if(o=e.result(n,p),o=m?m(o):o,r.type===t.Many){if(h&&!h.prototype instanceof i)throw Error("collectionType must inherit from Backbone.Collection");o instanceof i?c=o:g?(g._deferEvents=!0,g.set(o,a),c=g):(c=h?new h:this._createCollection(d),c.add(o,l))}else r.type===t.One&&d&&(o instanceof s?c=o:g&&g&&o[v]&&g.get(v)===o[v]?(g._deferEvents=!0,g._set(o,a),c=g):c=new d(o,l));(u=n[p]=c)&&!u._proxyCallback&&(u._proxyCallback=function(){return this._bubbleEvent.call(this,p,u,arguments)},u.on("all",u._proxyCallback,this))}n.hasOwnProperty(p)&&(r=n[p],d=this.attributes[p],r?(r.parents=r.parents||[],-1==e.indexOf(r.parents,this)&&r.parents.push(this)):d&&d.parents.length>0&&(d.parents=e.difference(d.parents,[this])))},this),r.set.call(this,n,a)},_bubbleEvent:function(t,n,r){var a,l=r[0].split(":"),u=l[0],p="nested-change"==r[0],f=r[1],h=r[2],m=-1,g=n._proxyCalls,v=-1!==e.indexOf(o,u);if(!p){if(e.size(l)>1&&(a=l[1]),-1!==e.indexOf(c,u)&&(h=f),n instanceof i&&v&&f){var x=d(a),y=e.initial(x);(l=n.find(function(e){if(f===e)return!0;if(!e)return!1;var t=e.get(y);return(t instanceof s||t instanceof i)&&f===t?!0:(t=e.get(x),(t instanceof s||t instanceof i)&&f===t||t instanceof i&&h&&h===t?!0:void 0)}))&&(m=n.indexOf(l))}return a=t+(-1===m||"change"!==u&&!a?"":"["+m+"]")+(a?"."+a:""),/\[\*\]/g.test(a)?this:(l=a.replace(/\[\d+\]/g,"[*]"),m=[],m.push.apply(m,r),m[0]=u+":"+a,g=n._proxyCalls=g||{},this._isEventAvailable.call(this,g,a)?this:(g[a]=!0,"change"===u&&(this._previousAttributes[t]=n._previousAttributes,this.changed[t]=n),this.trigger.apply(this,m),"change"===u&&this.get(a)!=r[2]&&this.trigger.apply(this,["nested-change",a,r[1]]),g&&a&&delete g[a],a!==l&&(m[0]=u+":"+l,this.trigger.apply(this,m)),this))}},_isEventAvailable:function(t,n){return e.find(t,function(e,t){return-1!==n.indexOf(t,n.length-t.length)})},_createCollection:function(t){var n=t;if(e.isString(n)&&(n=f(n)),!(n&&n.prototype instanceof s))throw Error("type must inherit from Backbone.AssociatedModel");return t=new i,t.model=n,t},_processPendingEvents:function(){this.visited||(this.visited=!0,this._deferEvents=!1,e.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],e.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents()},this),delete this.visited)},trigger:function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):r.trigger.apply(this,arguments)},toJSON:function(t){var n,i;return this.visited||(this.visited=!0,
n=r.toJSON.apply(this,arguments),this.relations&&e.each(this.relations,function(r){var a=this.attributes[r.key];a&&(i=a.toJSON(t),n[r.key]=e.isArray(i)?e.compact(i):i)},this),delete this.visited),n},clone:function(){return new this.constructor(this.toJSON())},_getAttr:function(t){var n,r,a=this,t=d(t);if(!(e.size(t)<1)){for(r=0;r<t.length&&(n=t[r],a);r++)a=a instanceof i?isNaN(n)?void 0:a.at(n):a.attributes[n];return a}}});var p=/[^\.\[\]]+/g,d=function(t){return""===t?[""]:e.isString(t)?t.match(p):t||[]},f=function(t){return e.reduce(t.split("."),function(e,t){return e[t]},u)},h=function(t,n,i){var r;return e.find(t,function(t){return(r=e.find(t.relations,function(e){return t.get(e.key)===n},this))?!0:void 0},this),r&&r.map?r.map(i):i},m={};e.each(["set","remove","reset"],function(e){m[e]=i.prototype[e],a[e]=function(t,n){return this.model.prototype instanceof s&&this.parents&&(arguments[0]=h(this.parents,this,t)),m[e].apply(this,arguments)}}),m.trigger=a.trigger,a.trigger=function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):m.trigger.apply(this,arguments)},a._processPendingEvents=s.prototype._processPendingEvents}.call(this),define("backbone.associations",["backbone"],function(e){return function(){var t;return t||e.Backbone.Associations}}(this)),define("js/models/chapter",["backbone","gettext","backbone.associations"],function(e,t){var n=e.AssociatedModel.extend({defaults:function(){return{name:"",asset_path:"",order:this.collection?this.collection.nextOrder():1}},isEmpty:function(){return!this.get("name")&&!this.get("asset_path")},parse:function(e){return"title"in e&&!("name"in e)&&(e.name=e.title,delete e.title),"url"in e&&!("asset_path"in e)&&(e.asset_path=e.url,delete e.url),e},toJSON:function(){return{title:this.get("name"),url:this.get("asset_path")}},validate:function(e,n){return e.name||e.asset_path?e.name?e.asset_path?void 0:{message:t("asset_path is required"),attributes:{asset_path:!0}}:{message:t("Chapter name is required"),attributes:{name:!0}}:{message:t("Chapter name and asset_path are both required"),attributes:{name:!0,asset_path:!0}}}});return n}),define("js/collections/chapter",["backbone","js/models/chapter"],function(e,t){var n=e.Collection.extend({model:t,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1},isEmpty:function(){return 0===this.length||this.every(function(e){return e.isEmpty()})}});return n}),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,n,i,r){return $.post(""+t()+e,n,i,r)},e.getWithPrefix=function(e,n,i,r){return $.get(""+t()+e,n,i,r)},e.ajaxWithPrefix=function(e,n){return null!=n?$.ajax(""+t()+e,n):(n=e,n.url=""+t()+n.url,$.ajax(n))}}}}.call(this),define("coffee/src/ajax_prefix",function(){}),function(e){e.cookie=function(t,n,i){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n||void 0===n)){if(i=e.extend({},i),(null===n||void 0===n)&&(i.expires=-1),"number"==typeof i.expires){var r=i.expires,a=i.expires=new Date;a.setDate(a.getDate()+r)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}i=n||{};for(var o,s=i.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),c=0;o=l[c]&&l[c].split("=");c++)if(s(o[0])===t)return s(o[1]||"");return null}}(jQuery),define("jquery.cookie",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.cookie}}(this)),function(e){"use strict";define("cms/js/main",["domReady","jquery","underscore.string","backbone","gettext","common/js/components/views/feedback_notification","coffee/src/ajax_prefix","jquery.cookie"],function(t,n,i,r,a,o){var s;return s=function(){return e.addAjaxPrefix(jQuery,function(){return n("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},window.CMS.URL=window.CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},_.extend(window.CMS,r.Events),r.emulateHTTP=!0,n.ajaxSetup({headers:{"X-CSRFToken":n.cookie("csrftoken")},dataType:"json"}),n(document).ajaxError(function(e,t,n){var i,r,s=a("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");if(n.notifyOnError!==!1)return r=t.getResponseHeader("content-type"),r&&r.indexOf("json")>-1&&t.responseText&&(s=JSON.parse(t.responseText).error),i=new o.Error({title:a("Studio's having trouble saving your work"),message:s}),console.log("Studio AJAX Error",{url:e.currentTarget.URL,response:t.responseText,status:t.status}),i.show()}),n.postJSON=function(e,t,i){return n.isFunction(t)&&(i=t,t=void 0),n.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),success:i})},t(function(){return window.onTouchBasedDevice()?n("body").addClass("touch-based-device"):void 0})},s(),s})}.call(this,AjaxPrefix),define("js/models/textbook",["backbone","underscore","gettext","js/models/chapter","js/collections/chapter","backbone.associations","cms/js/main"],function(e,t,n,i,r){var a=e.AssociatedModel.extend({defaults:function(){return{name:"",chapters:new r([{}]),showChapters:!1,editing:!1}},relations:[{type:e.Many,key:"chapters",relatedModel:i,collectionType:r}],initialize:function(){return this.setOriginalAttributes(),this},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())},reset:function(){this.set(this._originalAttributes,{parse:!0})},isDirty:function(){return!t.isEqual(this._originalAttributes,this.parse(this.toJSON()))},isEmpty:function(){return!this.get("name")&&this.get("chapters").isEmpty()},urlRoot:function(){return CMS.URL.TEXTBOOKS},parse:function(e){var n=$.extend(!0,{},e);return"tab_title"in n&&!("name"in n)&&(n.name=n.tab_title,delete n.tab_title),"url"in n&&!("chapters"in n)&&(n.chapters={url:n.url},delete n.url),t.each(n.chapters,function(e,t){e.order=e.order||t+1}),n},toJSON:function(){return{tab_title:this.get("name"),chapters:this.get("chapters").toJSON()}},validate:function(e,i){if(!e.name)return{message:n("Textbook name is required"),attributes:{name:!0}};if(0===e.chapters.length)return{message:n("Please add at least one chapter"),attributes:{chapters:!0}};var r=[];return e.chapters.each(function(e){e.isValid()||r.push(e)}),t.isEmpty(r)?void 0:{message:n("All chapters must have a name and asset"),attributes:{chapters:r}}}});return a}),define("js/collections/textbook",["backbone","js/models/textbook"],function(e,t){var n=e.Collection.extend({model:t,url:function(){return CMS.URL.TEXTBOOKS}});return n}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var i=null;i="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),n(i)},n=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var n="wmode=transparent";if(-1!==t.indexOf("?")){var i=t.split("?");if(-1===i[1].search("wmode=transparent")){var r=i[1],a=i[0];e(this).attr("src",a+"?"+n+"&"+r)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+n)}}else e(this).attr("wmode","transparent")})},i=function(t){if(t){var i=null,r=document.createElement("div");e(r).html(t),i=e(r).find("iframe, embed"),i.length>0&&(n(i),t=e(r).html())}return t};return{iframeBinding:t,iframeBindingHtml:i}}),define("js/utils/templates",["jquery","underscore"],function(e,t){var n=function(n){var i="#"+n+"-tpl",r=e(i).text();return r||console.error("Failed to load "+n+" template"),t.template(r)};return{loadTemplate:n}}),function(e){"use strict";e("common/js/components/views/feedback_prompt",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(e,t,n,i){var r,a,o=i.extend({options:e.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),i.prototype.render.apply(this,arguments)},show:function(){return i.prototype.show.apply(this,arguments),this.inFocus()},hide:function(){return i.prototype.hide.apply(this,arguments),this.outFocus()}});return r=t.compose(n.capitalize,n.camelize),a=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(a,function(t){var n;n=o.extend({options:e.extend({},o.prototype.options,{intent:t})}),o[r(t)]=n}),o})}.call(this,define||RequireJS.define),function(e,t){"use strict";e("common/js/components/utils/view_utils",["jquery","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(e,n,i,r,a){var o,s,l,c,u,p,d,f,h,m,g,v,x,y,b,w,k,S,j,T=65;return o=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},s=function(){e(".ui-loading").show()},l=function(){e(".ui-loading").hide()},c=function(e,t,n,r,o){return new a.Warning({title:e,message:t,actions:{primary:{text:n,click:function(e){e.hide(),r()}},secondary:{text:i("Cancel"),click:function(e){return o&&o(),e.hide()}}}}).show()},u=function(e,t){var n;return n=new r.Mini({title:i(e)}),n.show(),t().done(function(){n.hide()})},p=function(t){return function(n){var i=this;d(e(n.currentTarget),function(){return i[t].apply(i,[n])})}},d=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},y=function(t){return function(n){n.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},m=function(t){e("html, body").animate({scrollTop:t},500)},f=function(t){var n=t.offset().top;return n-e(window).scrollTop()},h=function(e,t){var n=e.offset().top,i=n-t;m(i)},g=function(e){window.location=e},v=function(){window.location.reload()},x=function(e,t){var i,r=e.changedAttributes();if(!r)return!1;for(i=0;i<t.length;i++)if(n.has(r,t[i]))return!0;return!1},b=function(e){return 0===e.length?i("Required field."):""},w=function(e,t){var n=b(e);if(n)return n;if(t){if(/\s/g.test(e))return i("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return i("Please do not use any spaces or special characters in this field.");return""},k=function(t){var i=n.reduce(t,function(t,n){return t+e(n).val().length},0);return T>=i},S=function(t,i,r,a){k(r)?e(t.errorWrapper).removeClass(i.shown).addClass(i.hiding):(e(t.errorWrapper).addClass(i.shown).removeClass(i.hiding),e(t.errorMessage).html("<p>"+n.template(a)({limit:T})+"</p>"),e(t.save).addClass(i.disabled))},j=function(n){var i=e.Deferred();return t([n],function(){i.resolve()},function(){i.reject()}),i.promise()},{toggleExpandCollapse:o,showLoadingIndicator:s,hideLoadingIndicator:l,confirmThenRunOperation:c,runOperationShowingMessage:u,withDisabledElement:p,disableElementWhileRunning:d,deleteNotificationHandler:y,setScrollTop:m,getScrollOffset:f,setScrollOffset:h,redirect:g,reload:v,hasChangedAttributes:x,validateRequiredField:b,validateURLItemEncoding:w,validateTotalKeyLength:k,checkTotalKeyLengthViolations:S,loadJavaScript:j}})}.call(this,define||RequireJS.define,require||RequireJS.require),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","common/js/components/utils/view_utils"],function(e,t,n,i,r,a,o){var s=n.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(e){t.bindAll(this,"beforeRender","render","afterRender"),this.options&&(e=t.extend({},t.result(this,"options"),e)),this.options=e;var i=this;this.render=t.wrap(this.render,function(e,t){return i.beforeRender(),e(t),i.afterRender(),i}),n.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){r.iframeBinding(this)},toggleExpandCollapse:function(t){var n=e(t.target);t.stopPropagation(),t.preventDefault(),o.toggleExpandCollapse(n,this.options.collapsedClass)},loadTemplate:function(e){return a.loadTemplate(e)}});return s}),define("js/models/uploads",["backbone","underscore","gettext"],function(e,t,n){var i=e.Model.extend({defaults:{title:"",message:"",selectedFile:null,uploading:!1,uploadedBytes:0,totalBytes:0,finished:!1,mimeTypes:[],fileFormats:[]},validate:function(e,i){return e.selectedFile&&!this.checkTypeValidity(e.selectedFile)?{message:t.template(n("Only <%= fileTypes %> files can be uploaded. Please select a file ending in <%= fileExtensions %> to upload."))(this.formatValidTypes()),attributes:{selectedFile:!0}}:void 0},fileTypes:function(){var e=t.map(this.attributes.mimeTypes,function(e){return e.split("/")[1].toUpperCase()}),n=t.map(this.attributes.fileFormats,function(e){return e.toUpperCase()});return e.concat(n)},checkTypeValidity:function(e){var n=this.attributes,i=function(e){return RegExp("(?:.+)\\.("+e.join("|")+")$","i")};return 0===n.mimeTypes.length&&0===n.fileFormats.length||t.contains(n.mimeTypes,e.type)||i(n.fileFormats).test(e.name)},formatValidTypes:function(){var e=this.attributes;if(1===e.mimeTypes.concat(e.fileFormats).length)return{fileTypes:this.fileTypes()[0],fileExtensions:"."+this.fileTypes()[0].toLowerCase()};var i=n("or"),r=function(e){return t.template("<%= initial %> <%= or %> <%= last %>")({initial:t.initial(e).join(", "),or:i,last:t.last(e)})};return{fileTypes:r(this.fileTypes()),fileExtensions:r(t.map(this.fileTypes(),function(e){return"."+e.toLowerCase()}))}}});return i}),define("js/views/modals/base_modal",["jquery","underscore","gettext","js/views/baseview"],function(e,t,n,i){var r=i.extend({events:{"click .action-cancel":"cancel"},options:t.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1,modalName:"basic",modalType:"generic",modalSize:"lg",title:"",modalWindowClass:".modal-window",viewSpecificClasses:""}),initialize:function(){var t=this.options.parent,n=this.options.parentElement;this.modalTemplate=this.loadTemplate("basic-modal"),this.buttonTemplate=this.loadTemplate("modal-button"),t?n=t.$el:n||(n=this.$el.closest(this.options.modalWindowClass),0===n.length&&(n=e("body"))),this.parentElement=n},render:function(){this.$el.html(this.modalTemplate({name:this.options.modalName,type:this.options.modalType,size:this.options.modalSize,title:this.getTitle(),viewSpecificClasses:this.options.viewSpecificClasses})),this.addActionButtons(),this.renderContents(),this.parentElement.append(this.$el)},getTitle:function(){return this.options.title},renderContents:function(){var e=this.getContentHtml();this.$(".modal-content").html(e)},getContentHtml:function(){return""},show:function(){this.render(),this.resize(),e(window).resize(t.bind(this.resize,this));var n=this.$el.find(this.options.modalWindowClass);n.focus()},hide:function(){this.undelegateEvents(),this.$el.html("")},cancel:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.hide()},addActionButtons:function(){this.options.addSaveButton&&this.addActionButton("save",n("Save"),!0),this.addActionButton("cancel",n("Cancel"))},addActionButton:function(e,t,n){var i=this.buttonTemplate({type:e,name:t,isPrimary:n});this.getActionBar().find("ul").append(i)},getActionBar:function(){return this.$(this.options.modalWindowClass+" > div > .modal-actions")},getActionButton:function(e){return this.getActionBar().find(".action-"+e)},enableActionButton:function(e){this.getActionBar().find(".action-"+e).prop("disabled",!1).removeClass("is-disabled")},disableActionButton:function(e){this.getActionBar().find(".action-"+e).prop("disabled",!0).addClass("is-disabled")},resize:function(){var t,n,i,r,a,o,s,l,c;i=this.$el.find(this.options.modalWindowClass),o=e(window).width(),s=e(window).height(),l=.8*o,c=.8*s,r=Math.min(i.outerWidth(),l),a=Math.min(i.outerHeight(),c),n=(o-r)/2,t=(s-a)/2,i.css({top:t+e(window).scrollTop(),left:n+e(window).scrollLeft()})}});return r}),function(e){"use strict";function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(n))}function n(t){var n=t.target,i=e(n);if(!i.is(":submit,input:image")){var r=i.closest(":submit");if(0===r.length)return;n=r[0]}var a=this;if(a.clk=n,"image"==n.type)if(void 0!==t.offsetX)a.clk_x=t.offsetX,a.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=i.offset();a.clk_x=t.pageX-o.left,a.clk_y=t.pageY-o.top}else a.clk_x=t.pageX-n.offsetLeft,a.clk_y=t.pageY-n.offsetTop;setTimeout(function(){a.clk=a.clk_x=a.clk_y=null},100)}function i(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var r={};r.fileapi=void 0!==e("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,e.fn.ajaxSubmit=function(t){function n(t){var n,i,r=e.param(t).split("&"),a=r.length,o={};for(n=0;a>n;n++)i=r[n].split("="),o[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return o}function a(i){for(var r=new FormData,a=0;a<i.length;a++)r.append(i[a].name,i[a].value);if(t.extraData){var o=n(t.extraData);for(var l in o)o.hasOwnProperty(l)&&r.append(l,o[l])}t.data=null;var c=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:s||"POST"});t.uploadProgress&&(c.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&(e.upload.onprogress=function(e){var n=0,i=e.loaded||e.position,r=e.total;e.lengthComputable&&(n=Math.ceil(i/r*100)),t.uploadProgress(e,i,r,n)}),e}),c.data=null;var u=c.beforeSend;return c.beforeSend=function(e,t){t.data=r,u&&u.call(this,e,t)},e.ajax(c)}function o(n){function r(e){var t=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;return t}function a(){function t(){try{var e=r(g).readyState;i("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(n){i("Server abort: ",n," (",n.name,")"),o(C),w&&clearTimeout(w),w=void 0}}var n=u.attr("target"),a=u.attr("action");k.setAttribute("target",f),s||k.setAttribute("method","POST"),a!=p.url&&k.setAttribute("action",p.url),p.skipEncodingOverride||s&&!/post/i.test(s)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(w=setTimeout(function(){b=!0,o(T)},p.timeout));var l=[];try{if(p.extraData)for(var c in p.extraData)p.extraData.hasOwnProperty(c)&&(e.isPlainObject(p.extraData[c])&&p.extraData[c].hasOwnProperty("name")&&p.extraData[c].hasOwnProperty("value")?l.push(e('<input type="hidden" name="'+p.extraData[c].name+'">').attr("value",p.extraData[c].value).appendTo(k)[0]):l.push(e('<input type="hidden" name="'+c+'">').attr("value",p.extraData[c]).appendTo(k)[0]));p.iframeTarget||(m.appendTo("body"),g.attachEvent?g.attachEvent("onload",o):g.addEventListener("load",o,!1)),setTimeout(t,15),k.submit()}finally{k.setAttribute("action",a),n?k.setAttribute("target",n):u.removeAttr("target"),e(l).remove()}}function o(t){if(!v.aborted&&!O){try{D=r(g)}catch(n){i("cannot access response document: ",n),t=C}if(t===T&&v)return v.abort("timeout"),void j.reject(v,"timeout");if(t==C&&v)return v.abort("server abort"),void j.reject(v,"error","server abort");if(D&&D.location.href!=p.iframeSrc||b){g.detachEvent?g.detachEvent("onload",o):g.removeEventListener("load",o,!1);var a,s="success";try{if(b)throw"timeout";var l="xml"==p.dataType||D.XMLDocument||e.isXMLDoc(D);if(i("isXml="+l),!l&&window.opera&&(null===D.body||!D.body.innerHTML)&&--M)return i("requeing onLoad callback, DOM not available"),void setTimeout(o,250);var c=D.body?D.body:D.documentElement;v.responseText=c?c.innerHTML:null,v.responseXML=D.XMLDocument?D.XMLDocument:D,l&&(p.dataType="xml"),v.getResponseHeader=function(e){var t={"content-type":p.dataType};return t[e]},c&&(v.status=Number(c.getAttribute("status"))||v.status,v.statusText=c.getAttribute("statusText")||v.statusText);var u=(p.dataType||"").toLowerCase(),f=/(json|script|text)/.test(u);if(f||p.textarea){var h=D.getElementsByTagName("textarea")[0];if(h)v.responseText=h.value,v.status=Number(h.getAttribute("status"))||v.status,v.statusText=h.getAttribute("statusText")||v.statusText;else if(f){var x=D.getElementsByTagName("pre")[0],y=D.getElementsByTagName("body")[0];x?v.responseText=x.textContent?x.textContent:x.innerText:y&&(v.responseText=y.textContent?y.textContent:y.innerText)}}else"xml"==u&&!v.responseXML&&v.responseText&&(v.responseXML=z(v.responseText));try{A=F(v,u,p)}catch(t){s="parsererror",v.error=a=t||s}}catch(t){i("error caught: ",t),s="error",v.error=a=t||s}v.aborted&&(i("upload aborted"),s=null),v.status&&(s=v.status>=200&&v.status<300||304===v.status?"success":"error"),"success"===s?(p.success&&p.success.call(p.context,A,"success",v),j.resolve(v.responseText,"success",v),d&&e.event.trigger("ajaxSuccess",[v,p])):s&&(void 0===a&&(a=v.statusText),p.error&&p.error.call(p.context,v,s,a),j.reject(v,"error",a),d&&e.event.trigger("ajaxError",[v,p,a])),d&&e.event.trigger("ajaxComplete",[v,p]),d&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,v,s),O=!0,p.timeout&&clearTimeout(w),setTimeout(function(){p.iframeTarget||m.remove(),v.responseXML=null},100)}}}var l,c,p,d,f,m,g,v,x,y,b,w,k=u[0],S=!!e.fn.prop,j=e.Deferred();if(e(":input[name=submit],:input[id=submit]",k).length)return alert('Error: Form elements must not have name or id of "submit".'),j.reject(),j;if(n)for(c=0;c<h.length;c++)l=e(h[c]),S?l.prop("disabled",!1):l.removeAttr("disabled");if(p=e.extend(!0,{},e.ajaxSettings,t),p.context=p.context||p,f="jqFormIO"+(new Date).getTime(),p.iframeTarget?(m=e(p.iframeTarget),y=m.attr("name"),y?f=y:m.attr("name",f)):(m=e('<iframe name="'+f+'" src="'+p.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),g=m[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n="timeout"===t?"timeout":"aborted";if(i("aborting upload... "+n),this.aborted=1,g.contentWindow.document.execCommand)try{g.contentWindow.document.execCommand("Stop")}catch(r){}m.attr("src",p.iframeSrc),v.error=n,p.error&&p.error.call(p.context,v,n,t),d&&e.event.trigger("ajaxError",[v,p,n]),p.complete&&p.complete.call(p.context,v,n)}},d=p.global,d&&0===e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[v,p]),p.beforeSend&&p.beforeSend.call(p.context,v,p)===!1)return p.global&&e.active--,j.reject(),j;if(v.aborted)return j.reject(),j;x=k.clk,x&&(y=x.name,y&&!x.disabled&&(p.extraData=p.extraData||{},p.extraData[y]=x.value,"image"==x.type&&(p.extraData[y+".x"]=k.clk_x,p.extraData[y+".y"]=k.clk_y)));var T=1,C=2,_=e("meta[name=csrf-token]").attr("content"),E=e("meta[name=csrf-param]").attr("content");E&&_&&(p.extraData=p.extraData||{},p.extraData[E]=_),p.forceSync?a():setTimeout(a,10);var A,D,O,M=50,z=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},R=e.parseJSON||function(e){return window.eval("("+e+")")},F=function(t,n,i){var r=t.getResponseHeader("content-type")||"",a="xml"===n||!n&&r.indexOf("xml")>=0,o=a?t.responseXML:t.responseText;return a&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),i&&i.dataFilter&&(o=i.dataFilter(o,n)),"string"==typeof o&&("json"===n||!n&&r.indexOf("json")>=0?o=R(o):("script"===n||!n&&r.indexOf("javascript")>=0)&&e.globalEval(o)),o};return j}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var s,l,c,u=this;"function"==typeof t&&(t={success:t}),s=this.attr("method"),l=this.attr("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:s||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var p={};if(this.trigger("form-pre-serialize",[this,t,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=t.traditional;void 0===d&&(d=e.ajaxSettings.traditional);var f,h=[],m=this.formToArray(t.semantic,h);if(t.data&&(t.extraData=t.data,f=e.param(t.data,d)),t.beforeSubmit&&t.beforeSubmit(m,this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[m,this,t,p]),p.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=e.param(m,d);f&&(g=g?g+"&"+f:f),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+g,t.data=null):t.data=g;var v=[];if(t.resetForm&&v.push(function(){u.resetForm()}),t.clearForm&&v.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var x=t.success||function(){};v.push(function(n){var i=t.replaceTarget?"replaceWith":"html";e(t.target)[i](n).each(x,arguments)})}else t.success&&v.push(t.success);t.success=function(e,n,i){for(var r=t.context||this,a=0,o=v.length;o>a;a++)v[a].apply(r,[e,n,i||u,u])};var y=e("input:file:enabled[value]",this),b=y.length>0,w="multipart/form-data",k=u.attr("enctype")==w||u.attr("encoding")==w,S=r.fileapi&&r.formdata;i("fileAPI :"+S);var j,T=(b||k)&&!S;t.iframe!==!1&&(t.iframe||T)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){j=o(m)}):j=o(m):j=(b||k)&&S?a(m):e.ajax(t),u.removeData("jqxhr").data("jqxhr",j);for(var C=0;C<h.length;C++)h[C]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(r){if(r=r||{},r.delegation=r.delegation&&e.isFunction(e.fn.on),!r.delegation&&0===this.length){var a={s:this.selector,c:this.context};return!e.isReady&&a.s?(i("DOM not ready, queuing ajaxForm"),e(function(){e(a.s,a.c).ajaxForm(r)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return r.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,r,t).on("click.form-plugin",this.selector,r,n),this):this.ajaxFormUnbind().bind("submit.form-plugin",r,t).bind("click.form-plugin",r,n)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n){var i=[];if(0===this.length)return i;var a=this[0],o=t?a.getElementsByTagName("*"):a.elements;if(!o)return i;var s,l,c,u,p,d,f;for(s=0,d=o.length;d>s;s++)if(p=o[s],c=p.name)if(t&&a.clk&&"image"==p.type)p.disabled||a.clk!=p||(i.push({name:c,value:e(p).val(),type:p.type}),i.push({name:c+".x",value:a.clk_x},{name:c+".y",value:a.clk_y}));else if(u=e.fieldValue(p,!0),u&&u.constructor==Array)for(n&&n.push(p),l=0,f=u.length;f>l;l++)i.push({name:c,value:u[l]});else if(r.fileapi&&"file"==p.type&&!p.disabled){n&&n.push(p);var h=p.files;if(h.length)for(l=0;l<h.length;l++)i.push({name:c,value:h[l],type:p.type});else i.push({name:c,value:"",type:p.type})}else null!==u&&"undefined"!=typeof u&&(n&&n.push(p),i.push({name:c,value:u,type:p.type,required:p.required}));if(!t&&a.clk){var m=e(a.clk),g=m[0];c=g.name,c&&!g.disabled&&"image"==g.type&&(i.push({name:c,value:m.val()}),i.push({name:c+".x",value:a.clk_x},{name:c+".y",value:a.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var i=this.name;if(i){var r=e.fieldValue(this,t);if(r&&r.constructor==Array)for(var a=0,o=r.length;o>a;a++)n.push({name:i,value:r[a]});else null!==r&&"undefined"!=typeof r&&n.push({name:this.name,value:r})}}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],i=0,r=this.length;r>i;i++){var a=this[i],o=e.fieldValue(a,t);null===o||"undefined"==typeof o||o.constructor==Array&&!o.length||(o.constructor==Array?e.merge(n,o):n.push(o))}return n},e.fieldValue=function(t,n){var i=t.name,r=t.type,a=t.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!i||t.disabled||"reset"==r||"button"==r||("checkbox"==r||"radio"==r)&&!t.checked||("submit"==r||"image"==r)&&t.form&&t.form.clk!=t||"select"==a&&-1==t.selectedIndex))return null;if("select"==a){var o=t.selectedIndex;if(0>o)return null;for(var s=[],l=t.options,c="select-one"==r,u=c?o+1:l.length,p=c?o:0;u>p;p++){var d=l[p];if(d.selected){var f=d.value;if(f||(f=d.attributes&&d.attributes.value&&!d.attributes.value.specified?d.text:d.value),c)return f;s.push(f)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,r=this.tagName.toLowerCase();n.test(i)||"textarea"==r?this.value="":"checkbox"==i||"radio"==i?this.checked=!1:"select"==r?this.selectedIndex=-1:t&&(t===!0&&/hidden/.test(i)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var n=this.type;if("checkbox"==n||"radio"==n)this.checked=t;else if("option"==this.tagName.toLowerCase()){var i=e(this).parent("select");t&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.ajaxForm}}(this)),define("js/views/uploads",["jquery","underscore","gettext","js/views/modals/base_modal","jquery.form"],function(e,t,n,i){var r=i.extend({events:t.extend({},i.prototype.events,{"change input[type=file]":"selectFile","click .action-upload":"upload"}),options:e.extend({},i.prototype.options,{modalName:"assetupload",modalSize:"med",successMessageTimeout:2e3,viewSpecificClasses:"confirm"}),initialize:function(){i.prototype.initialize.call(this),this.template=this.loadTemplate("upload-dialog"),this.listenTo(this.model,"change",this.renderContents),this.options.title=this.model.get("title")},addActionButtons:function(){this.addActionButton("upload",n("Upload"),!0),i.prototype.addActionButtons.call(this)},renderContents:function(){var t=this.model.isValid(),n=this.model.get("selectedFile"),r=this.$("input[type=file]").get(0);return i.prototype.renderContents.call(this),n&&t?(e(r).removeClass("error"),this.$("input[type=file]").replaceWith(r),this.$(".action-upload").removeClass("disabled")):this.$(".action-upload").addClass("disabled"),this},getContentHtml:function(){return this.template({url:this.options.url||CMS.URL.UPLOAD_ASSET,message:this.model.escape("message"),selectedFile:this.model.get("selectedFile"),uploading:this.model.get("uploading"),uploadedBytes:this.model.get("uploadedBytes"),totalBytes:this.model.get("totalBytes"),finished:this.model.get("finished"),error:this.model.validationError})},selectFile:function(t){var n=t.target.files[0]||null;this.model.set({selectedFile:n}),n&&e.isEmptyObject(this.model.changed)&&this.model.trigger("change")},upload:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("uploading",!0),this.$("form").ajaxSubmit({success:t.bind(this.success,this),error:t.bind(this.error,this),uploadProgress:t.bind(this.progress,this),data:{notifyOnError:!1}})},progress:function(e,t,n){this.model.set({uploadedBytes:t,
totalBytes:n})},success:function(e,t,n,i){this.model.set({uploading:!1,finished:!0}),this.options.onSuccess&&this.options.onSuccess(e,t,n,i);var r=this;this.removalTimeout=setTimeout(function(){r.hide()},this.options.successMessageTimeout)},error:function(){this.model.set({uploading:!1,uploadedBytes:0,title:n("We're sorry, there was an error")})}});return r}),define("text!templates/edit-chapter.underscore",[],function(){return'<div class="input-wrap field text required field-add-chapter-name chapter<%- order %>-name\n    <% if (error && error.attributes && error.attributes.name) { print(\'error\'); } %>">\n  <label for="chapter<%- order %>-name"><%- gettext("Chapter Name") %></label>\n  <input id="chapter<%- order %>-name" name="chapter<%- order %>-name" class="chapter-name short" placeholder="<%- StringUtils.interpolate(gettext("Chapter {order}"), {order: order}) %>" value="<%- name %>" type="text">\n  <span class="tip tip-stacked"><%- gettext("provide the title/name of the chapter that will be used in navigating") %></span>\n</div>\n<div class="input-wrap field text required field-add-chapter-asset chapter<%- order %>-asset\n    <% if (error && error.attributes && error.attributes.asset_path) { print(\'error\'); } %>">\n  <label for="chapter<%- order %>-asset-path"><%- gettext("Chapter Asset") %></label>\n  <input id="chapter<%- order %>-asset-path" name="chapter<%- order %>-asset-path" class="chapter-asset-path" placeholder="<%- StringUtils.interpolate(gettext("path/to/introductionToCookieBaking-CH{order}.pdf"), {order: order}) %>" value="<%- asset_path %>" type="text" dir="ltr">\n  <span class="tip tip-stacked"><%- gettext("upload a PDF file or provide the path to a Studio asset file") %></span>\n<button class="action action-upload"><%- gettext("Upload PDF") %></button>\n</div>\n<a href="" class="action action-close"><span class="icon fa fa-times-circle" aria-hidden="true"></span> <span class="sr"><%- gettext("delete chapter") %></span></a>\n'}),define("js/views/edit_chapter",["underscore","jquery","gettext","edx-ui-toolkit/js/utils/html-utils","js/views/baseview","js/models/uploads","js/views/uploads","text!templates/edit-chapter.underscore"],function(e,t,n,i,r,a,o,s){"use strict";var l=r.extend({initialize:function(){this.template=i.template(s),this.listenTo(this.model,"change",this.render)},tagName:"li",className:function(){return"field-group chapter chapter"+this.model.get("order")},render:function(){return i.setHtml(this.$el,this.template({name:this.model.get("name"),asset_path:this.model.get("asset_path"),order:this.model.get("order"),error:this.model.validationError})),this},events:{"change .chapter-name":"changeName","change .chapter-asset-path":"changeAssetPath","click .action-close":"removeChapter","click .action-upload":"openUploadDialog",submit:"uploadAsset"},changeName:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({name:this.$(".chapter-name").val()},{silent:!0}),this},changeAssetPath:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({asset_path:this.$(".chapter-asset-path").val()},{silent:!0}),this},removeChapter:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.collection.remove(this.model),this.remove()},openUploadDialog:function(t){t&&t.preventDefault&&t.preventDefault(),this.model.set({name:this.$("input.chapter-name").val(),asset_path:this.$("input.chapter-asset-path").val()});var i=new a({title:e.template(n("Upload a new PDF to “<%= name %>”"))({name:course.escape("name")}),message:n("Please select a PDF file to upload."),mimeTypes:["application/pdf"]}),r=this,s=new o({model:i,onSuccess:function(e){var t={};r.model.get("name")||(t.name=e.asset.displayname),t.asset_path=e.asset.portable_url,r.model.set(t)}});s.show()}});return l}),define("js/views/edit_textbook",["js/views/baseview","underscore","jquery","js/views/edit_chapter","common/js/components/views/feedback_notification"],function(e,t,n,i,r){var a=e.extend({initialize:function(){this.template=this.loadTemplate("edit-textbook"),this.listenTo(this.model,"invalid",this.render);var e=this.model.get("chapters");this.listenTo(e,"add",this.addOne),this.listenTo(e,"reset",this.addAll),this.listenTo(e,"all",this.render)},tagName:"section",className:"textbook",render:function(){return this.$el.html(this.template({name:this.model.get("name"),error:this.model.validationError})),this.addAll(),this},events:{"change input[name=textbook-name]":"setName",submit:"setAndClose","click .action-cancel":"cancel","click .action-add-chapter":"createChapter"},addOne:function(e){var t=new i({model:e});return this.$("ol.chapters").append(t.render().el),this},addAll:function(){this.model.get("chapters").each(this.addOne,this)},createChapter:function(e){e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.get("chapters").add([{}])},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$("#textbook-name-input").val(),{silent:!0})},setValues:function(){this.setName();var e=this;return t.each(this.$("li"),function(t,i){var r=e.model.get("chapters").at(i);r&&r.set({name:n(".chapter-name",t).val(),asset_path:n(".chapter-asset-path",t).val()})}),this},setAndClose:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()){var t=new r.Mini({title:gettext("Saving")}).show(),n=this;this.model.save({},{success:function(){n.model.setOriginalAttributes(),n.close()},complete:function(){t.hide()}})}},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.reset(),this.close()},close:function(){var e=this.model.collection;return this.remove(),this.model.isNew()&&e.remove(this.model),this.model.set("editing",!1),this}});return a}),define("js/views/show_textbook",["js/views/baseview","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(e,t,n,i,r){var a=e.extend({initialize:function(){this.template=t.template($("#show-textbook-tpl").text()),this.listenTo(this.model,"change",this.render)},tagName:"section",className:"textbook",events:{"click .edit":"editTextbook","click .delete":"confirmDelete","click .show-chapters":"showChapters","click .hide-chapters":"hideChapters"},render:function(){var e=$.extend({},this.model.attributes);return e.bookindex=this.model.collection.indexOf(this.model),e.course=window.course.attributes,this.$el.html(this.template(e)),this},editTextbook:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("editing",!0)},confirmDelete:function(e){e&&e.preventDefault&&e.preventDefault();var a=this.model;new r.Warning({title:t.template(n("Delete “<%= name %>”?"))({name:a.get("name")}),message:n("Deleting a textbook cannot be undone and once deleted any reference to it in your courseware's navigation will also be removed."),actions:{primary:{text:n("Delete"),click:function(e){e.hide();var t=new i.Mini({title:n("Deleting")}).show();a.destroy({complete:function(){t.hide()}})}},secondary:{text:n("Cancel"),click:function(e){e.hide()}}}}).show()},showChapters:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showChapters",!0)},hideChapters:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showChapters",!1)}});return a}),define("js/views/list_textbooks",["js/views/baseview","jquery","js/views/edit_textbook","js/views/show_textbook","common/js/components/utils/view_utils"],function(e,t,n,i,r){var a=e.extend({initialize:function(){this.emptyTemplate=this.loadTemplate("no-textbooks"),this.listenTo(this.collection,"all",this.render),this.listenTo(this.collection,"destroy",this.handleDestroy)},tagName:"div",className:"textbooks-list",render:function(){var e=this.collection;if(0===e.length)this.$el.html(this.emptyTemplate());else{this.$el.empty();var t=this;e.each(function(e){var r;r=e.get("editing")?new n({model:e}):new i({model:e}),t.$el.append(r.render().el)})}return this},events:{"click .new-button":"addOne"},addOne:function(e){var t,n;e&&e.preventDefault&&e.preventDefault(),this.collection.add([{editing:!0}]),t=this.$el.find("section:last"),r.setScrollOffset(t,0),n=t.find("input:first"),n.focus().select()},handleDestroy:function(e,t,n){t.remove(e)}});return a}),define("js/factories/textbooks",["gettext","js/models/section","js/collections/textbook","js/views/list_textbooks"],function(e,t,n,i){"use strict";return function(t){var r=new n(t,{parse:!0}),a=new i({collection:r});$(".content-primary").append(a.render().el),$(".nav-actions .new-button").click(function(e){a.addOne(e)}),$(window).on("beforeunload",function(){var t=r.find(function(e){return e.isDirty()});return t?e("You have unsaved changes. Do you really want to leave this page?"):void 0})}});