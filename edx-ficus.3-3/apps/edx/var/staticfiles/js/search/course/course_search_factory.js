!function(e){RequireJS.define("js/search/base/routers/search_router",["backbone"],function(e){"use strict";return e.Router.extend({routes:{"search/:query":"search"},search:function(e){this.trigger("search",e)}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/base/views/search_form",["jquery","backbone"],function(e,t){"use strict";return t.View.extend({el:"",events:{"submit form":"submitForm","click .cancel-button":"clearSearch"},initialize:function(){this.$searchField=this.$el.find(".search-field"),this.$searchButton=this.$el.find(".search-button"),this.$cancelButton=this.$el.find(".cancel-button")},submitForm:function(e){e.preventDefault(),this.doSearch()},doSearch:function(t){t?this.$searchField.val(t):t=this.$searchField.val();var s=e.trim(t);s?(this.setActiveStyle(),this.trigger("search",s)):this.clearSearch()},resetSearchForm:function(){this.$searchField.val(""),this.setInitialStyle()},clearSearch:function(){this.resetSearchForm(),this.trigger("clear")},setActiveStyle:function(){this.$searchField.addClass("is-active"),this.$searchButton.hide(),this.$cancelButton.show()},setInitialStyle:function(){this.$searchField.removeClass("is-active"),this.$searchButton.show(),this.$cancelButton.hide()}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/course/views/search_form",["js/search/base/views/search_form"],function(e){"use strict";return e.extend({el:"#courseware-search-bar"})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/base/models/search_result",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{location:[],content_type:"",excerpt:"",url:""}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/base/collections/search_collection",["backbone","js/search/base/models/search_result"],function(e,t){"use strict";return e.Collection.extend({model:t,pageSize:20,totalCount:0,latestModelsCount:0,accessDeniedCount:0,searchTerm:"",page:0,url:"/search/",fetchXhr:null,initialize:function(t,s){e.Collection.prototype.initialize.apply(this,arguments),s&&s.courseId&&(this.url+=s.courseId)},performSearch:function(e){this.fetchXhr&&this.fetchXhr.abort(),this.searchTerm=e||"",this.resetState(),this.fetchXhr=this.fetch({data:{search_string:e,page_size:this.pageSize,page_index:0},type:"POST",success:function(e,t){e.trigger("search")},error:function(e,t){e.trigger("error")}})},loadNextPage:function(){this.fetchXhr&&this.fetchXhr.abort(),this.fetchXhr=this.fetch({data:{search_string:this.searchTerm,page_size:this.pageSize,page_index:this.page+1},type:"POST",success:function(e,t){e.page+=1,e.trigger("next")},error:function(e,t){e.trigger("error")},add:!0,reset:!1,remove:!1})},cancelSearch:function(){this.fetchXhr&&this.fetchXhr.abort(),this.resetState()},parse:function(e){return this.latestModelsCount=e.results.length,this.totalCount=e.total,this.accessDeniedCount+=e.access_denied_count,this.totalCount-=this.accessDeniedCount,_.map(e.results,function(e){return e.data})},resetState:function(){this.page=0,this.totalCount=0,this.latestModelsCount=0,this.accessDeniedCount=0,this.reset()},hasNextPage:function(){return this.totalCount-(this.page+1)*this.pageSize>0},latestModels:function(){return this.last(this.latestModelsCount)}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/base/views/search_results_view",["jquery","underscore","backbone","gettext"],function(e,t,s,i){"use strict";return s.View.extend({el:"",contentElement:"",resultsTemplateId:"",loadingTemplateId:"",errorTemplateId:"",events:{},spinner:".search-load-next .icon",SearchItemView:function(){},initialize:function(){this.$contentElement=e(this.contentElement),this.resultsTemplate=t.template(e(this.resultsTemplateId).html()),this.loadingTemplate=t.template(e(this.loadingTemplateId).html()),this.errorTemplate=t.template(e(this.errorTemplateId).html())},render:function(){return this.$el.html(this.resultsTemplate({totalCount:this.collection.totalCount,totalCountMsg:this.totalCountMsg(),pageSize:this.collection.pageSize,hasMoreResults:this.collection.hasNextPage()})),this.renderItems(),this.$el.find(this.spinner).hide(),this.showResults(),this},renderNext:function(){this.$el.find(".search-count").text(this.totalCountMsg()),this.renderItems(),this.collection.hasNextPage()||this.$el.find(".search-load-next").remove(),this.$el.find(this.spinner).hide()},renderItems:function(){var e=this.collection.latestModels(),t=e.map(function(e){var t=new this.SearchItemView({model:e});return t.render().el},this);this.$el.find("ol").append(t)},totalCountMsg:function(){var e=ngettext("%s result","%s results",this.collection.totalCount);return interpolate(e,[this.collection.totalCount])},clear:function(){this.$el.hide().empty(),this.$contentElement.show()},showResults:function(){this.$el.show(),this.$contentElement.hide()},showLoadingMessage:function(){this.doCleanup(),this.$el.html(this.loadingTemplate()),this.showResults()},showErrorMessage:function(){this.$el.html(this.errorTemplate()),this.showResults()},doCleanup:function(){e("#loading-message").html(""),e("#error-message").html(""),this.$el.html("")},loadNext:function(e){return e&&e.preventDefault(),this.$el.find(this.spinner).show(),this.trigger("next"),!1}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/base/views/search_item_view",["jquery","underscore","backbone","gettext","logger"],function(e,t,s,i,r){"use strict";return s.View.extend({tagName:"li",templateId:"",className:"search-results-item",attributes:{role:"region","aria-label":"search result"},events:{click:"logSearchItem"},initialize:function(){this.tpl=t.template(e(this.templateId).html())},render:function(){var e=t.clone(this.model.attributes);return"Sequence"===this.model.get("content_type")&&(e.excerpt="",e.content_type=""),this.$el.html(this.tpl(e)),this},redirect:function(e){window.location.href=e},logSearchItem:function(e){e.preventDefault();var t=this,s=this.model.id,i=this.model.get("url"),n=this.model.collection,c=n.page,a=n.pageSize,o=n.searchTerm,l=n.indexOf(this.model);r.log("edx.course.search.result_selected",{search_term:o,result_position:c*a+l,result_link:s}).always(function(){t.redirect(i)})}})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/course/views/search_item_view",["js/search/base/views/search_item_view"],function(e){"use strict";return e.extend({templateId:"#course_search_item-tpl"})})}(define||RequireJS.define),function(e){RequireJS.define("js/search/course/views/search_results_view",["js/search/base/views/search_results_view","js/search/course/views/search_item_view"],function(e,t){"use strict";return e.extend({el:".courseware-results",contentElement:"#course-content",coursewareResultsWrapperElement:".courseware-results-wrapper",resultsTemplateId:"#course_search_results-tpl",loadingTemplateId:"#search_loading-tpl",errorTemplateId:"#search_error-tpl",events:{"click .search-load-next":"loadNext"},SearchItemView:t,clear:function(){e.prototype.clear.call(this),$(this.coursewareResultsWrapperElement).hide(),this.$contentElement.css("display","table-cell")},showResults:function(){e.prototype.showResults.call(this),$(this.coursewareResultsWrapperElement).css("display","table-cell")}})})}(define||RequireJS.define),function(e){"use strict";RequireJS.define("js/search/course/course_search_factory",["backbone","js/search/base/routers/search_router","js/search/course/views/search_form","js/search/base/collections/search_collection","js/search/course/views/search_results_view"],function(e,t,s,i,r){return function(n){var c=new t,a=new s,o=new i([],{courseId:n}),l=new r({collection:o}),h=_.clone(e.Events);h.listenTo(c,"search",function(e){a.doSearch(e)}),h.listenTo(a,"search",function(e){l.showLoadingMessage(),o.performSearch(e),c.navigate("search/"+e,{replace:!0})}),h.listenTo(a,"clear",function(){o.cancelSearch(),l.clear(),c.navigate("")}),h.listenTo(l,"next",function(){o.loadNextPage()}),h.listenTo(o,"search",function(){l.render()}),h.listenTo(o,"next",function(){l.renderNext()}),h.listenTo(o,"error",function(){l.showErrorMessage()})}})}(define||RequireJS.define);